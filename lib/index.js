var P="/components",O=".json",V="index",B0="http://localhost",M="/pages";var c="shared",x=".ts",U=process.cwd()+"/site",X0="shared_",_0=process.cwd()+"/templates",C=".template.ts";import{mkdir as r0,readdir as J0}from"node:fs/promises";import{join as l}from"path";async function z(H){if(Array.isArray(H))H=l(...H);return await J0(H)}function F(H,Q){return Bun.write(H,Q)}function N(H){return Bun.file(H).json()}async function R(H,Q){if(Array.isArray(H))H=l(...H);let $=await J0(H,{withFileTypes:!0}),Y={data:[],templates:[],styles:[]};for(let _ of $){let X=_.name;if(_.isDirectory()){let J=await R(l(H,X),X);if(Y.folders==null)Y.folders={};Y.folders[X]=J[X];continue}if(X.endsWith(C)){Y.templates.push(X.slice(0,-C.length));continue}if(X.endsWith(O))Y.data.push(X.slice(0,-O.length));if(X.endsWith("scss"))Y.styles.push(X.slice(0,-O.length))}return{[Q??H.split(/[\\/]/).pop()]:Y}}function W0(H,Q){F(H,JSON.stringify(Q,null,2))}async function G0(H){return await Bun.file(H).text()}async function K0(H){await r0(H,{recursive:!1})}function U0(H){return H.charAt(0).toUpperCase()+H.slice(1)}function V0(H){return H.charAt(0).toLowerCase()+H.slice(1)}import D from"isomorphic-dompurify";import h from"isomorphic-dompurify";function Z0(H){return typeof H==="string"}function E(H){if(Z0(H))return h.sanitize(H);if(Array.isArray(H))return H.map((Q)=>Z0(Q)?h.sanitize(Q):E(Q));if(typeof H==="object"&&H!==null){let Q={};for(let[$,Y]of Object.entries(H))Q[h.sanitize($)]=E(Y);return Q}return H}import q0 from"fs";import QH from"path";var p;((H)=>{H.DELETE="DELETE",H.GET="GET",H.OPTIONS="OPTIONS",H.PATCH="PATCH",H.POST="POST",H.PUT="PUT"})(p||={});function m(H){return typeof H==="string"}function b(H){if(m(H))return D.sanitize(H);if(Array.isArray(H))return H.map((Q)=>m(Q)?D.sanitize(Q):b(Q));if(typeof H==="object"&&H!==null){let Q={};for(let[$,Y]of Object.entries(H))Q[D.sanitize($)]=b(Y);return Q}return H}function M0(H){return D.sanitize(H)}function o0(H,Q=200,$=new Headers){if(Q>=300&&Q<400)return Response.redirect(H,Q);let Y={headers:$,status:Q};if(H===null)return new Response("",Y);if(m(H))return new Response(H,Y);return Response.json(H,Y)}var j={after:[],before:[]},O0;async function S(H,Q,$=o0){let Y=t0(H);j.before&&await A0(j.before,Y);let B=await a0(Y,Q);if(B.status)Y.result.status=B.status;if(B.headers){let _=typeof B.headers.get==="function"?B.headers.entries():Object.entries(B.headers);for(let[X,J]of _)Y.result.headers.set(X,J)}return Y.result.body=B.body??B,j.after&&await A0(j.after,Y),$(Y.result.body,Y.result.status,Y.result.headers)}function C0({after:H,before:Q}){if(Q)j.before=Q;if(H)j.after=H}async function a0(H,{handler:Q,inputSchema:$,outputSchema:Y}){if($&&!O0($,H.body))throw new Error("400|wrong body data");let B=Q.constructor.name==="AsyncFunction"?await Q(H):Q(H);if(Y&&!O0(Y,B))throw new Error("500|result is not as expected");return B}function t0(H){return{body:e0(H),context:{},headers:H.headers,method:H.method,params:H.params,query:H.url.includes("?")?new URLSearchParams(H.url.split("?")[1]):null,result:{body:null,headers:new Headers},url:H.url}}async function e0(H){if(H.method==="GET"||H.method==="DELETE"||H.method==="OPTIONS"||!H.body)return null;if(!H.json)throw new Error("400|Invalid body");try{let Q=await H.json();return E(Q)}catch(Q){throw new Error(`400|Invalid body
`+(Q instanceof Error?Q.message:Q))}}async function A0(H,Q){for(let $ of H)await $(Q)}var{file:HH}=globalThis.Bun;function I0(H,Q){return q0.readdirSync(H).forEach(($)=>{let Y=QH.join(H,$);if(q0.statSync(Y).isDirectory())Q=I0(Y,Q);else Q.push(Y)}),Q}function YH(H){try{let Q=I0(H,[]),$=H.split("/").pop(),Y=Q[0].indexOf($)+$.length;return{content:Q.map((B)=>B.slice(Y)),start:Q[0].slice(0,Y)}}catch(Q){let $="500|";if(!(Q instanceof Error))Q=new Error($+Q);else Q.message=$+Q.message;throw Q}}function s(H,Q){function $(J){if(J.endsWith(Y))J=J.replace(Y,"");return Q+J}if(Q??=H,Q.endsWith("/"))Q=Q.slice(0,-1);let Y="index.html",{content:B,start:_}=YH(H),X={};for(let J of B)X[$(J)]=$H(_+J);return X}function $H(H){return()=>new Response(HH(H))}var k=[];async function w0(){if(k.length=0,k=z0(await R(U+M),!0).map((H)=>H.slice(M.length)).map((H)=>H.endsWith(".index")?H.split("/").slice(0,-1).join("/")+"/":H),k[0]==="")k[0]="/"}function T(H,Q,$=k){return $.filter((Y)=>{let B=Y.split("/").pop();if(!H&&Y.endsWith("+"))return!1;if(!Q&&B?.startsWith("_"))return!1;return!0})}function z0(H,Q=!1,$=""){let Y=[];for(let B in H){let _=H[B],X=`${$}/${B}`.replace(/\/+/g,"/"),J=_.data.includes(V),W=_.templates.some((G)=>G.endsWith(V)),K=_.templates.some((G)=>G.endsWith("childs"));if(J&&W)Y.push(X);if(K){Q&&Y.push(`${X}/+`);for(let G of _.data)G!==V&&Y.push(`${X}/${G}`)}if(_.folders){let G=z0(_.folders,Q,X);Y.push(...G)}}return Y}async function j0(){return await N(U+"/"+c+O)}async function y(H){return await N(H)}async function b0(H,Q,$,Y){let[B,_,X]=Y.split("."),J=_&&_.startsWith(X0)?!0:!1,W=J?U+"/"+c+O:H;return{target:W,dataToSave:I(await N(W),BH($,X,_,Q)),isSharedData:J}}function I(H,Q){let $={...H};for(let Y of Object.keys(Q)){let B=Q[Y];if(typeof B==="object"&&B!==null&&!Array.isArray(B)){let _=$[Y];$[Y]=I(typeof _==="object"&&_!==null?_:{},B)}else $[Y]=B}return $}function BH(H,Q,$,Y){if($===void 0&&Q===void 0)return{[H]:b(Y)};return Q===void 0?{[H]:{[$]:b(Y)}}:{[H]:{[Q]:{[$]:b(Y)}}}}import{z as f,ZodDefault as F0,ZodEnum as XH,ZodOptional as i}from"zod";function R0(H){let Q=H._def.shape(),$=Object.keys(Q).filter((Y)=>{let B=Q[Y];return(B.unwrap?.()??B)instanceof f.ZodObject});return $.length===0?H.parse({}):H.parse(Object.fromEntries(new Map($.map((Y)=>[Y,{}]))))}function n(H){let Q=H._def.shape(),$=Object.keys(Q).filter((Y)=>{let B=Q[Y];return(B.unwrap?.()??B)instanceof f.ZodObject});return $.length===0?x0(H):Object.fromEntries(new Map($.map((Y)=>[Y,x0(Q[Y])])))}function x0(H){let Q=H.shape,$={};for(let Y in Q){let B=Q[Y],_=B instanceof i,X=_H(B._def.description,!1),J=d(B),W;if(X)W=_&&!X.endsWith("?")?X+"?":X;else W=_?J:J.replace(/\?$/,"");$[Y]=W}return $}function d(H){if(H instanceof i)return d(H._def.innerType)+"?";if(H instanceof F0)return d(H._def.innerType);switch(H._def.typeName){case"ZodString":return"string";case"ZodNumber":return"number";case"ZodBoolean":return"boolean";case"ZodDate":return"Date";case"ZodEnum":return"enum";default:return"unknown"}}function _H(H,Q){if(!H)return;let{message:$,wrapper:Y}=H.startsWith("{")?JSON.parse(H):{message:H,wrapper:null};if(Q)return $;return Y}function S0(H){let Q={},$=H.shape;for(let Y in $){let B=$[Y];while(B instanceof i||B instanceof F0)B=B._def.innerType;if(B instanceof XH)Q[Y]=B._def.values}return Q}import k0 from"isomorphic-dompurify";var u={},JH=[],WH={addMmsg:a,addPageData:N0,components:u,dataFromPage:E0,render:UH,sendError:VH};async function L0(){if(Object.keys(u).length>0)return;let H=U+P,$=(await z(H)).filter((Y)=>!Y.endsWith(x));for(let Y of $)u[Y]=await KH(H,Y)}function GH(H,Q,$=WH){let{addMmsg:Y,addPageData:B,components:_,dataFromPage:X,render:J,sendError:W}=$,K=P0(),{schema:G,template:A}=_[H],Z=X(H,Q);if(G===void 0&&A===void 0)return W(`Component ${H} not found or has no schema or template`);if(G===void 0&&!r(Z)&&A.length>0)return W(`Schema not found for component ${H}, and no data found${Q!==void 0?" for "+Q:""} in pageData`);if(Z=G!==null?I(R0(G),Z):Z,G!==null&&r(Z)){let q=G.safeParse(Z);if(!q.success)return W("Error in "+H+(Q!==void 0?"."+Q:"")+": "+q.error.message)}if(K){if(r(Z)&&B(H,Q,Z),G!==null&&G!==void 0){let q=n(G);o(H,q),["enum","enum?"].some((n0)=>Object.values(q).includes(n0))&&o("_enum."+H,S0(G))}}return J({data:Z,editorMode:K,pageSettings:D0(),template:A,component:H,id:Q})}async function KH(H,Q,$=JH,Y=x){let{description:B,isSingle:_,schema:X,template:J}=await import(`${H}/${Q}/${Q}${Y}`);return _===!0&&$.push(Q),{description:B,schema:X,template:J}}function UH({data:H,editorMode:Q,pageSettings:$,component:Y,id:B,template:_}){let X=_({[Y]:H,pageSettings:$});if(Q){let W=new RegExp(`data-editor="${Y}(.*?)"`,"g");return B!==void 0?X.replace(W,(G,A)=>{return`data-editor="${Y}${A}.${B}"`}):X}if(!X.includes("data-editor"))return X;let J=k0.sanitize(X,{RETURN_DOM_FRAGMENT:!0});for(let W of Array.from(J.querySelectorAll("[data-editor]")))W.setAttribute("data-editor",W.getAttribute("data-editor").replace(/-[^-]+$/,""));return k0.sanitize(X)}function VH(H){return a(H),""}function ZH(H){return JSON.stringify(H)}function r(H){if(!H||H===void 0)return!1;if(Object.keys(H).length>0)return!0;return!1}function v0(){return n(u.pageSettings.schema)}import{JSDOM as OH}from"jsdom";import{join as t}from"path";async function e(H){let Q=new URL(B0+H).pathname,$=[U,M],Y=Q.split("/").slice(1).filter((J)=>J!==""),B=Y[Y.length-1],_="";for(let J of Y)try{await z([...$,J]),$.push(J)}catch(W){_=`${$[$.length-1]}.childs`,B=J;break}let X=t(...$);if(!_){let J=Y[Y.length-1];if(Y.length>0&&B===J)_+=`${J}.`,B=`${J}.${V}`;else B=V;_+=V}if(Y.length===0)B=V,_=V;return{templateToLoad:t(X,_+C),dataToLoad:t(X,B+O)}}var v=[],H0={},T0=!1,w={},L={};async function y0(H,Q){v.length=0,await L0();let{templateToLoad:$,dataToLoad:Y}=await e(H);try{let{template:B}=await import($);return w=I(await y(Y),await j0()),Q?AH(B):f0(B())}catch(B){console.log("Error",B)}}function f0(H){if(typeof H!=="string")return H;return H.replace(/\n+/g," ").replace(/\s{2,}/g," ").replace(/>\s+</g,"><").trim()}function AH(H){T0=!0,H0={pageSettings:v0()},L.pageSettings=w.pageSettings;let Q=H(),$=`
  <script src="https://cdn.tiny.cloud/1/2twbfyfjocws7ln2yp1xbioznajuwpd2obek1kwsiev66noc/tinymce/7/tinymce.min.js" referrerpolicy="origin"></script>

  <script src="/_editor/interface.js" defer></script>
  <script>
    var editorData = ${JSON.stringify(H0)}
    var pageData   = ${JSON.stringify(L)}
    var messages   = ${JSON.stringify(v)}
  </script>
  <link href="/_editor/style.css" rel="stylesheet" />`;return Q.replace(/<head>/,`<head>${$}`)}function a(H){v.push(H)}function P0(){return T0}function o(H,Q){H0[H]=Q}function N0(H,Q,$){if(L[H]??={},Q!==void 0)L[H][Q]=$;else L[H]=$}function E0(H,Q){return Q!==void 0?w[H]?.[Q]:w[H]}function D0(){return w.pageSettings}async function u0({component:H,data:Q,editorData:$,url:Y}){let{templateToLoad:B,dataToLoad:_}=await e(Y),{dataToSave:X,isSharedData:J,target:W}=await b0(_,Q,H,$);await W0(W,X),v.length=0;let K=J?X:await y(W),G=J?await y(_):X;w=I(G,K);let{template:A}=await import(B),Z=await A(),q=new OH(Z).window.document;return{content:f0(q.querySelector("body").innerHTML),pageData:w,messages:v}}var g0={...s(U+"/public","/"),...s(__dirname+"/adminInterface","/_editor")};async function c0(H){return await S(H,{handler:async(Q)=>{let $=new URL(Q.url).pathname;if(!T(!1,!1).includes($))throw new Error("404|page "+$+" not found");return{status:200,body:await y0(M0($),!0),headers:{"Content-Type":"text/html"}}}})}var l0="/api/v1",h0={[l0+"/update-partial"]:{[p.POST]:(H)=>S(H,{handler:async(Q)=>{return{body:await u0(await Q.body),status:200}}})},[l0+"/siteTree"]:(H)=>S(H,{handler:async()=>{return{body:await T(!1,!0),status:200}}})};var m0={},qH={error(H){let[Q,$]=H.message.includes("|")?H.message.split("|"):["500",H.message];return console.error(H.message,{status:Q,msg:$},H.stack),new Response($??H.message,{headers:{"Content-Type":"text/html"},status:parseInt(Q)})},fetch:async(H)=>{return await c0(H)},websocket:{message(){m0.publish("connection","connected")}},port:4001,routes:{...h0,...g0}};function p0(){m0=Bun.serve(qH)}C0({after:[async(H)=>{H.result.headers.set("Cache-Control","no-cache")}]});var g;((Q)=>Q.CHANGE="change")(g||={});var Q0;((Q)=>Q.SCSS="scss")(Q0||={});var Y0;(($)=>{$.COMPONENTS="components";$.PAGES="pages"})(Y0||={});import*as s0 from"sass";async function $0(H=!1){let Q={charset:!0,sourceMap:!H,loadPaths:[U+"/css"]};if(H)Q.style="compressed";let $=await s0.compileAsync(U+"/css/style.scss",Q);F(U+"/public/style.css",$.css.toString()),console.log("css generated")}import{watch as MH}from"chokidar";function d0(H,Q,$,Y){let B=MH(H,{persistent:!0});function _(W){for(let K of Q)if(W.endsWith(K))return K;return null}function X(W){for(let K of $)if(W.includes(K)&&!W.endsWith(K))return K;return null}function J(W,K){return _(K)}for(let W of Object.values(g))B.on(W,(K)=>{let G=J(W,K);G!==null&&Y[W][G]()})}function i0(){d0([process.cwd()+"/site"],Object.values(Q0),Object.values(Y0),{change:{scss:$0}})}async function D4(){p0(),await w0(),i0()}var T4={createDirectory:K0,firstLetterLowerCase:V0,firstLetterUppercase:U0,getFolderContent:z,getFolderContentRecursive:R,readFileAsString:G0,writeToFile:F},y4={componentFolder:P,dataExtension:O,index:V,pageFolder:M,projectRoot:U,templateExtension:C,templateFolder:_0,tsExtension:x};export{T4 as utils,GH as useComponent,D4 as startYajsb,$0 as makeCss,ZH as describeComponent,y4 as constants};
